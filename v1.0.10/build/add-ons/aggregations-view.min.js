"use strict";!function(){function e(e){this.grid=e;var t=this,i=Object.getPrototypeOf(this.grid),o=Object.getPrototypeOf(this.grid.behavior),r=Object.getPrototypeOf(this.grid.behavior.dataModel);i.setAggregateGroups=function(e,t){this.behavior.setAggregateGroups(e,t)}.bind(this.grid),o.setAggregateGroups=function(e,t){this.dataModel.setAggregateGroups(e,t),this.createColumns(),setTimeout(function(){this.changed()}.bind(this.grid.behavior),100)}.bind(this.grid.behavior),r.setAggregateGroups=function(e,i){this.sources.aggregator.setAggregateGroups(e,i),t.setRelation(e,i)}.bind(this.grid.behavior.dataModel)}function t(e){var t=this.sources.aggregator,i=!(!t||!t.viewMakesSense());return i&&e&&(i=e.dataCell.x===t.treeColumnIndex),i}e.prototype={constructor:e.prototype.constructor,setPipeline:function(i){i=i||{};var o=this instanceof e,r=i.dataModelPrototype||o&&this.grid.behavior.dataModel,a=i.firstPipe||r.pipeline[0];if(!r)throw"Expected dataModel.";if(!a)throw"Expected pipe (data source pipeline descriptor).";i.dataModelPrototype?(r.truncatePipeline(),r.addPipe(a)):r.pipeline=[a],r.addPipe({type:"DataSourceAggregator",test:t}),i.includeFilter&&r.addPipe({type:"DataSourceGlobalFilter"}),i.includeSorter&&(r.addPipe({type:"DataSourceSorterComposite"}),r.addPipe({type:"DataNodeGroupSorter",parent:"DataSourceAggregator"})),o&&(this.grid.behavior.setData(r.source.data),this.grid.behavior.shapeChanged())},setRelation:function(e,t){var i=this.grid.behavior,o=i.dataModel,r=!!e.length&&!!t.length,a=o.sources.aggregator,s=i.getPrivateState(),n=i.getColumn(a.treeColumnIndex).getProperties();return r?(this.editableWas=!!n.editable,n.editable=!1,this.checkboxOnlyRowSelectionsWas=s.checkboxOnlyRowSelections,s.checkboxOnlyRowSelections=!0):(n.editable=this.editableWas,s.checkboxOnlyRowSelections=this.checkboxOnlyRowSelectionsWas),this.grid.selectionModel.clear(),this.grid.clearMouseDown(),o.applyAnalytics(),i.shapeChanged(),r}},window.fin.Hypergrid.AggregationsView=e}();