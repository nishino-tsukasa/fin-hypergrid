"use strict";!function(){function e(e){var t=this;this.grid=e;var i=Object.getPrototypeOf(this.grid),r=Object.getPrototypeOf(this.grid.behavior),o=Object.getPrototypeOf(this.grid.behavior.dataModel);i.setGroups=function(e){this.behavior.setGroups(e)}.bind(this.grid),i.fireSyntheticGroupsChangedEvent=function(e){var t={groups:e,time:Date.now(),grid:this},i=new CustomEvent("fin-groups-changed",{detail:t});this.canvas.dispatchEvent(i)}.bind(this.grid),r.setGroups=function(e){this.dataModel.setGroups(e),this.createColumns(),this.changed()}.bind(this.grid.behavior),r.getGroups=function(){return this.dataModel.getGroups()}.bind(this.grid.behavior),r.getAvailableGroups=function(){return this.dataModel.getAvailableGroups()}.bind(this.grid.behavior),o.getGroups=function(){for(var e=this.getHeaders().slice(1),t=this.getFields().slice(0),i=this.sources.groupview.groupBys,r=[],o=0;o<i.length;o++){var s=e[i[o]];r.push({id:i[o],label:s,field:t})}return r}.bind(this.grid.behavior.dataModel),o.setGroups=function(e){this.sources.groupview.setGroupBys(e),t.setRelation(e),this.grid.fireSyntheticGroupsChangedEvent(this.getGroups())}.bind(this.grid.behavior.dataModel),o.getAvailableGroups=function(){for(var e=this.sources.source.getHeaders().slice(0),t=this.sources.groupview.groupBys,i=[],r=0;r<e.length;r++)if(t.indexOf(r)===-1){var o=e[r];i.push({id:r,label:o,field:o})}return i}.bind(this.grid.behavior.dataModel)}function t(e){var t=this.sources.groupview,i=!(!t||!t.viewMakesSense());return i&&e&&(i=e.dataCell.x===t.treeColumnIndex),i}e.prototype={constructor:e.prototype.constructor,setPipeline:function(i){i=i||{};var r=this instanceof e,o=i.dataModelPrototype||r&&this.grid.behavior.dataModel,s=i.firstPipe||o.pipeline[0];if(!o)throw"Expected dataModel.";if(!s)throw"Expected pip (data source pipeline descriptor).";i.dataModelPrototype?(o.truncatePipeline(),o.addPipe(s)):o.pipeline=[s],i.includeFilter&&o.addPipe({type:"DataSourceGlobalFilter"}),o.addPipe({type:"DataSourceGroupView",test:t}),i.includeSorter&&o.addPipe({type:"DataNodeGroupSorter",parent:"DataSourceGroupView"}),r&&(this.grid.behavior.setData(o.source.data),this.grid.behavior.shapeChanged())},setRelation:function(e){var t=this.grid.behavior,i=t.dataModel,r=i.sources.groupview,o=!!e.length,s=t.getPrivateState(),a=t.getColumn(r.treeColumnIndex).getProperties();return o?(this.editableWas=!!a.editable,a.editable=!1,this.checkboxOnlyRowSelectionsWas=s.checkboxOnlyRowSelections,s.checkboxOnlyRowSelections=!0):(a.editable=this.editableWas,s.checkboxOnlyRowSelections=this.checkboxOnlyRowSelectionsWas),this.grid.selectionModel.clear(),this.grid.clearMouseDown(),i.applyAnalytics(),t.shapeChanged(),o}},window.fin.Hypergrid.GroupView=e}();